@{
	ViewData["Title"] = "Tool Inventory List";
}
@using Microsoft.AspNetCore.Http
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
<script src="~/js/3.3.1Version/jquery.min.js"></script>
<style>
	table,
	th,
	tr,
	td {
		border: 1px solid black;
		border-collapse: collapse;
		text-align: left;
	}

	.Border0px {
		width: 100%;
	}

	.TableWidth {
		width: 100%;
	}

	.Tables-AndTablesTextBox {
		width: 100%;
	}

</style>
<form id="#frmInventory">
<section class="content">
	<div class="row">
		<div class="col-12">

			<div class="card card-primary">
				<div class="card-header">
					<div class="row">
						<div class="col-md-6">
							<h3 class="card-title trn">Tool Room Instruments</h3>
						</div>
					</div>
				</div>
				<!-- /.card-header -->
				<div id="ToolMaster" class="card-body">
					<table id="tblTool" class="table table-bordered table-striped" style="width:100%">
						<thead>
							<tr>
								<th class="trn">Instrument Name</th>
								<th class="trn">Serial Number</th>
								<th class="trn">Lab ID Number</th>
								<th class="trn">Range</th>
								<th class="trn">Department</th>
								<th class="trn">DueDate</th>
								<th class="trn">ReplacementLabID</th>
									<th class="trn" style="text-align:left;" data-orderable="false">
									Select All
									<br />
									<input type="checkbox" id="selectAll" value="selectAll"/>
								</th>
							</tr>
						</thead>
						<tbody>
							@foreach (var item in Model)
							{
								<tr>

									<td id="InstrumentName">

										@* 	<a href="#" onclick="PopUpListing1('@item.InstrumentName','@item.Id');"> *@

										@item.InstrumentName
										@* </a> *@

									</td>


									<td id="SlNo">@item.SlNo</td>
									<td>@item.IdNo</td>
									<td>@item.Range</td>
									<td>@item.DepartmentName</td>
									<td>@item.DueDate.ToString("dd-MM-yyyy")</td>
									@if (@item.ToolRoomStatus == 1)
									{
										<td id="ReplacementLabID_@item.Id" href="#">
											@item.ReplacementLabID
										</td>
										<td id="ChkInput" style="text-align:left;">
												<input id="ChkInput_@item.Id" name="ChkInput" type="checkbox" value="0" disabled />
												<input type="hidden" id="popupcount_@item.Id" name="popupcount" value="">
											<input type="hidden" id="instrumentid" value="">
										</td>
									}
									else
									{ 

										<td id="ReplacementLabID_@item.Id" onclick="PopUpListing1('@item.InstrumentName','@item.Id');" href="#">
												<input type="hidden" id="popupcount_@item.Id" name="popupcount" value="">
											</td>
										<td id="ChkInput" style="text-align:left;">
											<input type="hidden" id="instrumentid" name="instrumentid" value="@item.Id">
												<input id="ChkInput_@item.Id" name="ChkInput" type="checkbox" />@* onchange="ValidateReplacementLabID(\"" + encodeURI(ReplacementLabID_+@item.Id) + " \")" *@
										
										</td>

									}


									@* 	<td id="instrumentid" style="display:none;">
								<input type="hidden" id="instrumentid" value="@item.Id">
								</td>
								<td style="display:none;">
								<input type="hidden" id="CreatedBy" value="@item.CreatedBy">
								</td>
								*@
								</tr>
							}

						</tbody>
					</table>
				</div>
				<div id="ToolHistoryDetails" class="modal fade" role="dialog">
					<div class="modal-dialog modal-lg">

						<!-- Modal content-->
						<div class="modal-content">
							<div class="modal-header">

								<h4 class="modal-title">Tool Room Instruments</h4>
								@* <button type="button" class="close" data-dismiss="modal">&times;</button> *@
							</div>
							<div class="modal-body">
								<div class="card-body">

									@* 	LabID	Name	DepartName	DueDate
									Ts-01	Test Instrument 01	LAB	2023-06-27 17:53:22.550 *@

									<table id="tblPopUp" class="table table-bordered table-striped" style="width:100%">
										<thead>
											<tr>
												<th class="trn">Name</th>
												<th class="trn">Lab ID Number</th>
												<th class="trn">Department</th>
												<th class="trn">Due Date</th>
											</tr>
										</thead>
										<tbody>

											@* @foreach (var item in Model)
											{
											<tr>
											<td>@item.IdNo</td>
											<td id="InstrumentName">
											<a href='@Url.Action("ToolInventory","Instrument", new {UserDept= @item.UserDept })'>

											@item.InstrumentName
											</a>

											</td>
											<td>@item.DepartmentName</td>
											<td>@item.DueDate.ToString("dd-MM-yyyy")</td>



											<td>
											<input id="ChkInput" name="ChkInput" type="checkbox" value="" />
											</td>
											@* <td>
											<input type="hidden" id="RequestId" value="@item.RequestId">

											</td>
											<td>
											<input type="hidden" id="instrumentid" value="@item.Id">
											</td>
											</tr>
											} *@
										</tbody>
									</table>
								</div>

							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal" onclick="HidePopUp();">Close</button>
							</div>
						</div>

					</div>
				</div>

			</div>
			<div class="form-group" style="text-align:right;">
				<input style="margin-top: 32px;" type="button" class="btn btn-primary trn" name="btnSubmit" id="btnSubmit" value="Submit"
					   onclick="SaveInventoryCalibration(lang);">
				<a href='@Url.Action("Request","Tracker")'> <input type="button" style="margin-top: 32px;" class="btn btn-default trn" value="Cancel"></a>
			</div>


			<!-- /.card-body -->
		</div>
		<!-- /.card -->
	</div>
	<!-- /.col -->
	</div>
	<!-- /.row -->
</section>
</form>
<script>
	
	setTimeout(function () {
		$("#tblTool").DataTable({
			"paging": true,
			"lengthChange": true,
			"searching": true,
			"ordering": true,
			"info": true,
			"autoWidth": true,
			"responsive": true,
		});
	}, 500);
</script>


<script>

	
		$(function () {
			//For Select All CheckBox Functionality
			$('#selectAll').click(function (e) {

				var table = $(e.target).closest('table');
				if (this.checked) {

					$('td input:checkbox', table).prop('checked', true);
					// showWarning("Please Select the ReplacementLabId", lang);
				}
				else {
					$('td input:checkbox', table).prop('checked', false);
				}

			});


		});
	
	function showPopUp() {

		$("#ToolHistoryDetails").modal('show');
	}
	function HidePopUp() {

		//$("#" + ChkId).attr("disabled", true);

		$("#ToolHistoryDetails").modal('hide');
		
	}
	function PopUpListing1(InstrumentName, Id) {

		var rows = "";
		var MasterLabID = Id;
		$.ajax({
			type: 'GET',
			url: '../Instrument/PopUpInstrumentList',
			data: { InstrumentName: InstrumentName, InstrumentId: Id },
			dataType: 'json',
			success: function (data) {

				$("#ToolHistoryDetails").modal('show');
				$('#tblPopUp tbody').empty();
				console.log(data);
				$.each(data, function (i, item) {
					var currentRow = $(this).closest("tr");

					var date = new Date($.now());

					var dueDate = moment(item.dueDate).format("DD-MM-YYYY");
					var LabId = encodeURI(item.idNo);


					rows = "<tr>"
						+ "<td>"
						+ "<a href = '#' onclick='MasterToolListing(\"" + encodeURI(item.idNo) + "\"," + MasterLabID + ");'>" + item.instrumentName
						+ "</a>"
						+ "</td>"
						+ "<td>" + item.idNo + "</td>"
						+ "<td>" + item.departmentName + "</td>"
						+ "<td>" + dueDate + "</td>"
						+ "</tr>"
					$('#tblPopUp tbody').append(rows);
					$('#dvload').hide();
					
					
				});
					var currentRow = $(this).closest("tr");

				//$("#popupcount").val($('#tblPopUp >tbody >tr').length);
				$("#popupcount_" + MasterLabID).val($('#tblPopUp >tbody >tr').length);

				if ($('#tblPopUp >tbody >tr').length == 0) { 
					
					var ChkoutId = "ChkInput_" + MasterLabID;
					$("#" + ChkoutId).attr("disabled", true);

				}
				// console.log("pop value");
				// console.log($("#popupcount_"+MasterLabID).val());
				 // $("#tblPopUp").DataTable({
				// 	"paging": true,""
				// 	"lengthChange": true,
				// 	"searching": true,
				// 	"ordering": true,
				// 	"info": true,
				// 	"autoWidth": true,
				// 	"responsive": true,
				// });

				$('.overlay').hide();
			
			},
			error: function (emp) {
				$('#dvload').hide();
				console.log("data");

				console.log("Error List PopUp");
				console.log(data);

			}
		});
		HidePopUp();
	}


	function MasterToolListing(ReplacementidNo, MasterLabID) {
		
		var RLabId = decodeURI(ReplacementidNo);
		var id = "ReplacementLabID_"+ MasterLabID;
		var ChkId = "ChkInput_"+ MasterLabID;
		$("#" + id).text(RLabId);
		
		$("#" + ChkId).prop("checked",true);
		console.log(ChkId);
		//$('td input:checkbox', table).prop('checked', true);

		HidePopUp();
	}

</script>